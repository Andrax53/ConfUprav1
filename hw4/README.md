# Задание 4

# Учебная Виртуальная Машина (УВМ)

## Описание
Данный проект представляет собой реализацию учебной виртуальной машины (УВМ), включающую в себя ассемблер и интерпретатор. УВМ поддерживает набор базовых команд для работы с памятью и регистрами, а также специальные операции, такие как byte swap.

## Структура проекта
- `uvm.py` - основной файл с реализацией ассемблера и интерпретатора
- `test_vm.py` - модульные тесты
- `test_program.asm` - пример программы на ассемблере
- `program.log` - лог-файл с информацией о скомпилированных инструкциях

## Система команд
1. `load_const` - загрузка константы в регистр
   - Формат: `load_const адрес константа`
   - Размер: 4 байта

2. `read_memory` - чтение из памяти
   - Формат: `read_memory цель адрес смещение`
   - Размер: 6 байт

3. `write_memory` - запись в память
   - Формат: `write_memory адрес смещение источник`
   - Размер: 6 байт

4. `bswap` - операция byte swap
   - Формат: `bswap источник цель`
   - Размер: 4 байта

## Использование

### Установка зависимостей
```bash
pip install pytest pyyaml
```

### Запуск ассемблера
```bash
python uvm.py <входной_файл.asm> <выходной_файл.bin> <лог_файл.log>
```

Например:
```bash
python uvm.py test_program.asm output.bin program.log
```

### Запуск тестов
```bash
python -m pytest test_vm.py -v
```

## Формат ассемблерной программы
```assembly
# Пример программы
load_const 0, 5        # Загрузка числа 5 в регистр 0
load_const 1, 0        # Загрузка числа 0 в регистр 1

loop_start:            # Метка для цикла
    read_memory 2, 1, 100  # Чтение из памяти
    bswap 2, 2            # Выполнение byte swap
    write_memory 1, 0, 2  # Запись результата в память
```

## Формат лог-файла
Лог-файл создается в формате YAML и содержит информацию о каждой инструкции:
- Название инструкции
- Аргументы
- Бинарное представление

## Особенности реализации
- Поддержка меток для организации циклов и переходов
- Различные размеры инструкций (4 или 6 байт)
- Битовая адресация полей инструкций
- Порядок байтов: little-endian

## Ограничения
- Максимальное количество регистров: 16
- Размер памяти определяется при создании интерпретатора
- Не поддерживаются комментарии внутри инструкций
