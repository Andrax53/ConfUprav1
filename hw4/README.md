# Учебная Виртуальная Машина (УВМ)

Этот проект реализует ассемблер и интерпретатор для Учебной Виртуальной Машины (УВМ) с определенным набором инструкций. Реализация включает поддержку программирования на языке ассемблера, генерацию бинарного кода и выполнение программ.

## Набор Инструкций

УВМ поддерживает четыре базовые инструкции:

### 1. Загрузка Константы (LOAD)
- Формат: `LOAD addr const`
- Размер: 4 байта
- Кодировка: `[82][addr_hi][addr_lo|const_hi][const_lo]`
- Пример: `LOAD 352 346` → `0x52 0xB0 0xD0 0x0A`

### 2. Чтение из Памяти (READ)
- Формат: `READ dest src offset`
- Размер: 6 байт
- Кодировка: `[19][dest_hi][dest_lo|src_hi][src_lo|offset_hi][offset_lo][0x00]`
- Пример: `READ 511 112 71` → `0x93 0xFF 0x80 0x83 0x23 0x00`

### 3. Запись в Память (WRITE)
- Формат: `WRITE base offset src`
- Размер: 6 байт
- Кодировка: `[31][base_hi][base_lo|offset_hi][offset_lo|src_hi][src_lo][0x00]`
- Пример: `WRITE 27 148 883` → `0x9F 0x0D 0xA0 0x64 0x6E 0x00`

### 4. Обмен Байтов (BSWAP)
- Формат: `BSWAP src dest`
- Размер: 4 байта
- Кодировка: `[22][src_hi][src_lo|dest_hi][dest_lo]`
- Пример: `BSWAP 810 188` → `0x16 0x95 0xE1 0x05`

## Структура Проекта

- `assembler.py` - Ассемблер для преобразования кода УВМ в бинарный формат
- `interpreter.py` - Интерпретатор для выполнения бинарных программ УВМ
- `test_vm.py` - Набор тестов для виртуальной машины
- `spec_test.asm` - Тестовые примеры из спецификации
- `test_program.asm` - Пример программы, выполняющей обмен байтов вектора
- `requirements.txt` - Зависимости Python-пакетов

## Требования

- Python 3.6+
- PyYAML
- pytest

Установка зависимостей:
```bash
pip install -r requirements.txt
```

## Использование

### Ассемблирование Программы

```bash
python assembler.py input.asm output.bin --log output.log
```

Аргументы:
- `input.asm` - Входной файл ассемблера
- `output.bin` - Выходной бинарный файл
- `--log output.log` - Лог-файл с деталями ассемблирования в формате YAML

### Запуск Программы

```bash
python interpreter.py program.bin output.yaml --start START_ADDR --end END_ADDR
```

Аргументы:
- `program.bin` - Входной бинарный файл
- `output.yaml` - Выходной файл с дампом памяти
- `--start` - Начальный адрес диапазона памяти для дампа
- `--end` - Конечный адрес диапазона памяти для дампа

## Пример Программы

Вот простая программа, которая выполняет обмен байтов для вектора из 5 элементов:

```assembly
; Инициализация вектора значениями
LOAD 100 0x12
LOAD 101 0x34
LOAD 102 0x56
LOAD 103 0x78
LOAD 104 0x9A

; Выполнение обмена байтов для каждого элемента
BSWAP 100 100
BSWAP 101 101
BSWAP 102 102
BSWAP 103 103
BSWAP 104 104
```

## Тестирование

Запуск набора тестов:
```bash
python -m pytest test_vm.py
```

Набор тестов включает:
- Модульные тесты для каждой инструкции
- Тестовые примеры из спецификации
- Интеграционный тест с полной программой

## Формат Вывода

### Лог Ассемблера (YAML)
```yaml
- opcode: LOAD
  addr: 352
  const: 346
  binary: 0x52 0xb0 0xd0 0x0a
```

### Дамп Памяти (YAML)
```yaml
memory_range:
  start: 100
  end: 104
  values: [72, 44, 106, 30, 89]
```
